nano index.html<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ByZaPa ‚Äì Generador</title>
  <style>
    :root{
      --bg:#0f1c24; --card:#172935; --muted:#8fb0c3; --txt:#e9f3f9;
      --grad1:#ff8a00; --grad2:#e52e71;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--txt); background:radial-gradient(80vw 80vh at 10% -10%,#223848,transparent),
      radial-gradient(70vw 60vh at 100% 0%,#1b2f3d,transparent), var(--bg);
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .wrap{width:100%; max-width:980px; display:grid; gap:24px}
    h1{margin:0; font-size:clamp(28px,4.5vw,46px); letter-spacing:.5px;
      background:linear-gradient(90deg,var(--grad1),var(--grad2));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;}
    .sub{color:var(--muted); margin-top:6px}
    .grid{display:grid; grid-template-columns: 1.1fr .9fr; gap:24px}
    @media (max-width:900px){ .grid{grid-template-columns:1fr}}
    .card{background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08);
      border-radius:16px; padding:16px; backdrop-filter: blur(6px);}
    label{font-weight:600; font-size:14px; color:#cfe4f2; margin:10px 0 8px; display:block}
    textarea,input,select{
      width:100%; border:1px solid #294250; background:#0f1f29; color:var(--txt);
      border-radius:10px; padding:12px 14px; font-size:15px; outline:none;
    }
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .row3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px}
    button{
      width:100%; padding:14px; border:none; border-radius:12px; font-weight:700;
      font-size:16px; cursor:pointer; color:white;
      background:linear-gradient(90deg,var(--grad1),var(--grad2));
      transition: transform .12s ease, filter .12s ease;
    }
    button:hover{ transform: translateY(-1px); filter:brightness(1.05);}
    .img{width:100%; border-radius:12px; border:1px solid rgba(255,255,255,.08);
      background:#0c1820; aspect-ratio:1/1; display:flex; align-items:center; justify-content:center}
    .caption{margin-top:10px; color:var(--muted); font-size:13px}
    .pill{display:inline-flex; gap:8px; align-items:center; font-size:12px; color:#b8d5e6}
    .err{color:#ff8e9e; background:#3a1a23; border:1px solid #5b2a35; padding:10px 12px; border-radius:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <div>
      <h1>üöÄ ByZaPa ‚Äì Generador de Im√°genes</h1>
      <div class="sub">Elige estilo, aspecto y calidad. Luego pega tu prompt y ¬°dale ca√±a!</div>
    </div>

    <div class="grid">
      <!-- Panel de controles -->
      <div class="card">
        <label>Descripci√≥n (prompt)</label>
        <textarea id="prompt" rows="4" placeholder="Un retrato cinematogr√°fico, luz suave, depth of field..."></textarea>

        <label>Negativos (opcional)</label>
        <input id="neg" placeholder="baja calidad, manos malformadas, ruido..."/>

        <div class="row">
          <div>
            <label>Estilo</label>
            <select id="style">
              <option value="ninguno">‚Äî Sin preset ‚Äî</option>
              <option value="realista">Realista</option>
              <option value="cinematografico">Cinematogr√°fico</option>
              <option value="arte-digital">Arte digital</option>
              <option value="anime">Anime</option>
              <option value="pixel">Pixel art</option>
              <option value="producto">Foto de producto</option>
              <option value="retrato">Retrato</option>
              <option value="arquitectura">Arquitectura</option>
            </select>
          </div>
          <div>
            <label>Calidad</label>
            <select id="quality">
              <option value="standard">Est√°ndar (mejor)</option>
              <option value="fast">R√°pida (m√°s barata)</option>
            </select>
          </div>
        </div>

        <div class="row3">
          <div>
            <label>Relaci√≥n de aspecto</label>
            <select id="ratio">
              <option value="1:1">1:1 (cuadrado)</option>
              <option value="3:2">3:2</option>
              <option value="2:3">2:3</option>
              <option value="16:9">16:9</option>
              <option value="9:16">9:16</option>
            </select>
          </div>
          <div>
            <label>Tama√±o base</label>
            <select id="base">
              <option value="512">512</option>
              <option value="768">768</option>
              <option value="1024" selected>1024</option>
            </select>
          </div>
          <div>
            <label>Semilla (opcional)</label>
            <input id="seed" type="number" min="0" placeholder="aleatoria"/>
          </div>
        </div>

        <div style="margin-top:14px; display:flex; gap:12px; align-items:center">
          <button id="btn" onclick="generate()">Generar</button>
          <span class="pill" id="status">Listo</span>
        </div>

        <div id="error" style="margin-top:12px; display:none" class="err"></div>
      </div>

      <!-- Resultado -->
      <div class="card">
        <div id="imageBox" class="img">üñºÔ∏è Tu imagen aparecer√° aqu√≠</div>
        <div class="caption" id="caption"></div>
      </div>
    </div>
  </div>

<script>
  function stylePrompt(style){
    switch(style){
      case 'realista':          return 'estilo realista, foto n√≠tida, texturas naturales';
      case 'cinematografico':   return 'estilo cinematogr√°fico, iluminaci√≥n dram√°tica, color grading, bokeh';
      case 'arte-digital':      return 'arte digital, ilustraci√≥n detallada';
      case 'anime':             return 'estilo anime, l√≠neas limpias, colores vivos';
      case 'pixel':             return 'pixel art, 8-bit, baja resoluci√≥n est√©tica';
      case 'producto':          return 'foto de producto, fondo neutro, iluminaci√≥n de estudio';
      case 'retrato':           return 'retrato, piel natural, ojos enfocados, iluminaci√≥n suave';
      case 'arquitectura':      return 'arquitectura, l√≠neas rectas, perspectiva, materiales realistas';
      default:                  return '';
    }
  }

  function computeSize(ratio, base){
    const [wR,hR] = ratio.split(':').map(Number);
    let w = +base, h = Math.round(+base * (hR/wR));
    // Para ratios panor√°micos ajustamos al mayor lado = base
    if (wR>hR){ w=+base; h=Math.round(+base*(hR/wR)); }
    else if (hR>wR){ h=+base; w=Math.round(+base*(wR/hR)); }
    return {width: Math.max(256,w), height: Math.max(256,h)};
  }

  async function generate(){
    const prompt = document.getElementById('prompt').value.trim();
    const neg    = document.getElementById('neg').value.trim();
    const style  = document.getElementById('style').value;
    const ratio  = document.getElementById('ratio').value;
    const base   = document.getElementById('base').value;
    const seedV  = document.getElementById('seed').value;
    const quality= document.getElementById('quality').value;

    if(!prompt){ return msg('Escribe un prompt.', true); }

    const {width,height} = computeSize(ratio, base);
    const styled = [prompt, stylePrompt(style)].filter(Boolean).join(', ');

    setBusy(true);
    msg('', false, true);

    try{
      const res = await fetch('/api/generate', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          prompt: styled,
          negative_prompt: neg || undefined,
          width, height,
          seed: seedV ? Number(seedV) : undefined,
          quality
        })
      });

      // Respuesta debe ser JSON { image: "data:image/png;base64,..." } o { error: "..." }
      const dataText = await res.text();
      let data;
      try { data = JSON.parse(dataText); }
      catch(e){
        throw new Error('Respuesta no v√°lida del servidor: ' + dataText.slice(0,120) + '‚Ä¶');
      }

      if(data.error) throw new Error(data.error);

      const img = new Image();
      img.src = data.image;
      img.alt = 'Imagen generada';
      img.style.maxWidth = '100%';
      img.style.borderRadius = '12px';

      const box = document.getElementById('imageBox');
      box.innerHTML = '';
      box.appendChild(img);

      document.getElementById('caption').textContent =
        `Tama√±o ${width}√ó${height} ‚Ä¢ Estilo: ${style} ‚Ä¢ Modo: ${quality}`;
      setBusy(false);
    }catch(err){
      setBusy(false);
      msg('‚ùå ' + err.message, true);
    }
  }

  function setBusy(b){
    const btn = document.getElementById('btn');
    const st  = document.getElementById('status');
    btn.disabled = b;
    btn.textContent = b ? 'Generando‚Ä¶' : 'Generar';
    st.textContent  = b ? 'Trabajando' : 'Listo';
  }
  function msg(t, isErr=false, hide=false){
    const el = document.getElementById('error');
    if(hide){ el.style.display='none'; return; }
    el.textContent = t;
    el.style.display = t ? 'block' : 'none';
  }
</script>
</body>
</html>
